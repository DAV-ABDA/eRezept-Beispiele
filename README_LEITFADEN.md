## Leitfaden für die Erstellung von Interoperabilitätsbeispielen  

Bei den Tests der Anwendungssysteme auf ihre Interoperabilität (Konnektathon der gematik) stellte sich heraus, dass es nicht realistisch ist, sich von einem Konnektathon-Partner Hunderte oder Tausende E-Rezepte zu wünschen oder zu erwarten, daß die gematik solche Mengen von Testrezepten bereitstellen kann (geschweige denn separate Sätze für jedes AVS und ARZ). Auch wird es bei einem Test zwischen Systemen selten möglich sein, ganze Beispielsammlungen wie die hier vorliegende durchzuführen.

Um mit den machbaren kleineren Rezeptanzahlen den größtmöglichen Effekt erzielen zu können, ist es notwendig, die wichtigsten Testfälle zu identifizieren und diese möglichst durch Kombination orthogonaler Fälle in eine minimale Anzahl von Testrezepten (bzw. ggf. Tripeln von eVerordnung, Quittung und eAbgabedaten) aufzustellen.

Was am wichtigsten ist, wird sich von Fall zu Fall unterscheiden, und Dinge wie anstehende neue Spezifikationsversionen können diesbezüglich Veränderungen mit sich bringen. Die Identifikation, Dokumentation und Diskussion wichtiger Testfälle kann aber trotzdem für alle Beteiligten eine bedeutende Hilfe sein. Die begleitenden Beispieldatensätze (ggf. mit notwendigen präzisen Instruktionen für die Dispensierung) können den Aufwand für solche Tests so reduzieren, daß sie für einen größeren Teil der Betroffenen realisierbar werden.

Aus praktischen Gründen werden wichtigen Testfälle in fundamentale und essenzielle unterschieden:

**Fundamentale Testfälle** geben Auskunft über fundamentale Aspekte der Fähigkeit einer verarbeitenden Stelle, standardkonforme Daten zu verarbeiten. Sie sind aber nicht notwendigerweise Kandidaten für die Sammlung essenzieller Testfälle. So kann zum Beispiel eine sendende Stelle durch Nichtverwendung von XML-PräfIxen die Wahrscheinlichkeit von diesbezüglichen Problemen auf verarbeitender Seite praktisch auf Null reduzieren. Fundamentale Testfälle dienen damit vorwiegend zum Erkennen fundamentaler Einschränkungen der Fähigkeit zur Verarbeitung standardkonformer Daten in bestimmten Abschnitten der Verarbeitungskette (insb. bei den Datenannahmestellen der Kassen) und der Ausarbeitung von Empfehlungen wie der zum Verzicht auf XML-Präfixe. Ähnliches gilt zum Beispiel für die Zeichenkodierung. Bei Verwendung von UTF-16 oder UTF-32 ist zu erwarten, daß Empfänger Verarbeitungsprobleme bekommen, während es mit US-ASCII oder UTF-8 praktisch keine Probleme geben sollte.

**Essenzielle Testfälle** zielen dagegen auf solche Spezifikationselemente, bei denen keine Wahlmöglichkeit besteht und die somit von allen Elementen der Prozeßkette fehlerfrei verarbeitet werden müssen, und die außerdem aufgrund ihrer Natur besondere Herausforderungen bei der Umsetzung mit sich bringen. Zum Beispiel liegt Im Fall der Patienten-Mehrkosten eine besondere Herausforderung darin, daß diese Beträge in FHIR und EDIFACT grundsätzlich anders zu behandeln sind. In FHIR sind die Mehrkosten Teil des ausgewiesenen Bruttobetrages, in ABRP dagegen nicht.

Fundamentale Testfälle sind eher Kandidaten für entsprechende Zusatztests in lokal anzuwendenen Testbatterien, während essenzielle Testfälle für Tests mit eingeschränkter 'Rezeptbandbreite' zwischen Systemen gedacht sind.

Ein wichtiger Punkt bei essenziellen Testfällen ist Reduktion auf das absolute, unabdingbare Minimum einerseits und maximale Kombination orthogonaler Testfälle in einer minimalen Anzahl von Testdatensätzen andererseits. Beispielsweise können die Testfälle 'Eigenbeteiligung nach § 27a' und 'Mehrkosten Patient' in ein und derselben Abgabedatenzeile kombiniert werden. Bei Wahl eines Mittels mit ungeradem Festbetrag kann damit noch ein weiteres Spezifikationselement abgedeckt werden, nämlich daß eventuelle Rundungspfennige der Eigenbeteiligung zuzuschlagen sind und nicht dem Erstattungsbetrag der Kasse.

Ein Vorschlag für die Aufnahme eines essenziellen Testfalles sollte zum einen alle testrelevanten Variationen des jeweiligen Spezifikationselements angeben und zum anderen ausarbeiten, wie diese möglichst umfangreich in einen einzigen Testdatensatz abgedeckt werden können. Ersteres ist wesentlich für eine fundierte Diskussion des jeweiligen Testfalles innerhalb des GitHub-Issues, letzteres ist eine wichtige Voraussetzung für die konkrete Umsetzung. Ebenfalls wichtig ist die Motivation - also herauszuarbeiten, was den Testfall essenziell macht und ihn aus der großen Menge existierender bzw. möglicher Testfälle heraushebt (e.g. Vorliegen eines ERPFINDs, Möglichkeit der Komplettabweisung einer Abrechnung/Datenlieferung).

Beispiele für Testfall-Vorschläge hier im Repo:

- [Essenzieller Testfall: Eigenbeteiligung nach § 27a i.V.m. Mehrkosten](https://github.com/DAV-ABDA/eRezept-Beispiele/issues/19)
- [Fundamentaler Testfall: Möglichkeiten für Bundle-interne Referenzen](https://github.com/DAV-ABDA/eRezept-Beispiele/issues/16)

Die Ausarbeitung eines konkreten Testdatensatzes ist auch dann wichtig, wenn der Datensatz selber aufgrund der Natur der Teststrecke nicht direkt in den Testprozeß eingespeist werden kann. Beispielsweise können PVS und AVS in der Regel nicht einfach Testrezepte aus Beispielsammlungen laden. Beispieldatensatz und eventuelle Instruktionen in der Beschreibung geben aber der erzeugenden Stelle entscheidende Hilfe, mit einem Minimum an Aufwand einen korrekten Datensatz mit den notwendigen Eigenschaften erzeugen zu können. Wenn ein solcher Datensatz schon fix und fertig in der Beispielsammlung vorliegt, dann reicht natürlich ein entsprechender Link. ;-)

Erzeugende Stellen können die kuratierten Testfälle auch als Bausteine zum automatischen Generieren einer konkreten Serie von Testdatensätzen verwenden, analog zu den Gematik-'Hausaufgaben' für die AVS-Hersteller und Rechenzentren Ende 2021. Das spielt auch insofern eine Rolle, als manche Datenannahmestellen der Kassen auch im Testverfahren E-Rezept-Ids nicht mehrfach aus verschiedenen Quellen annehmen können. Daher benötigt jeder Testpartner E-Rezepte mit eigenen Ids, auch wenn die Testverordnungen ansonsten komplett gleichen Inhalt haben.

Idealerweise reduziert sich die Arbeit des Kurators auf Prüflesung und Auflisten/Verlinken der Testfälle in einer Markdown-Datei.
